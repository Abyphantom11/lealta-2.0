<!DOCTYPE html>
<html>
<head>
    <title>Configurar Business Routing</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 10px; }
        .success { background: #28a745; color: white; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .error { background: #dc3545; color: white; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .info { background: #17a2b8; color: white; padding: 10px; border-radius: 5px; margin: 10px 0; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 5px; overflow: auto; }
    </style>
</head>
<body>
    <h1>üöÄ Configuraci√≥n Business Routing - Lealta 2.0</h1>
    
    <div class="info">
        <strong>Estado:</strong> Configurando routing din√°mico para lanzamiento ma√±ana
    </div>
    
    <h2>1. Configurar Base de Datos</h2>
    <button class="button" onclick="setupDatabase()">Configurar Business Routing</button>
    <div id="dbResult"></div>
    
    <h2>2. URLs Disponibles</h2>
    <div class="info">
        <strong>Despu√©s de la configuraci√≥n, estas URLs estar√°n disponibles:</strong><br>
        ‚Ä¢ <a href="/demo/admin" target="_blank">/demo/admin</a> - Panel de Administraci√≥n<br>
        ‚Ä¢ <a href="/demo/staff" target="_blank">/demo/staff</a> - Panel de Staff<br>
        ‚Ä¢ <a href="/demo/cliente" target="_blank">/demo/cliente</a> - Portal Cliente<br><br>
        
        <strong>URLs Legacy (redirigen autom√°ticamente):</strong><br>
        ‚Ä¢ <a href="/admin" target="_blank">/admin</a> ‚Üí /demo/admin<br>
        ‚Ä¢ <a href="/staff" target="_blank">/staff</a> ‚Üí /demo/staff<br>
    </div>
    
    <h2>3. Pruebas</h2>
    <button class="button" onclick="testRouting()">Probar Rutas</button>
    <div id="testResult"></div>
    
    <h2>4. Informaci√≥n del Sistema</h2>
    <pre id="systemInfo">
üéØ Business Routing Implementation Status
=========================================

‚úÖ Rutas din√°micas creadas:
   - src/app/[businessId]/admin/page.tsx
   - src/app/[businessId]/staff/page.tsx  
   - src/app/[businessId]/cliente/page.tsx

‚úÖ API de validaci√≥n:
   - /api/businesses/[businessId]/validate

‚úÖ Redirects autom√°ticos:
   - /admin ‚Üí /demo/admin
   - /staff ‚Üí /demo/staff

üîß Middleware preparado para:
   - Validaci√≥n de business context
   - Headers de contexto (x-business-id)
   - Seguridad por business

üìä Base de datos:
   - Campo subdomain en tabla Business
   - Validaci√≥n de business activo
   - Separaci√≥n de datos por negocio
    </pre>

    <script>
        async function setupDatabase() {
            const resultDiv = document.getElementById('dbResult');
            resultDiv.innerHTML = '<div class="info">Configurando base de datos...</div>';
            
            try {
                const response = await fetch('/api/setup/business-routing', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <strong>‚úÖ Configuraci√≥n exitosa!</strong><br>
                            ${data.message}<br><br>
                            <strong>Negocios configurados:</strong><br>
                            ${data.businesses.map(b => `‚Ä¢ ${b.subdomain} ‚Üí ${b.name} (${b.id})`).join('<br>')}
                            <br><br>
                            <strong>Rutas disponibles:</strong><br>
                            ${data.routes.join('<br>')}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå Error: ${data.error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Error de red: ${error.message}</div>`;
            }
        }
        
        async function testRouting() {
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = '<div class="info">Probando rutas...</div>';
            
            const tests = [
                { name: 'Validar business demo', url: '/api/businesses/demo/validate' },
                { name: 'Validar business_1', url: '/api/businesses/business_1/validate' }
            ];
            
            let results = '<div class="success"><strong>Resultados de pruebas:</strong></div>';
            
            for (const test of tests) {
                try {
                    const response = await fetch(test.url);
                    const status = response.ok ? '‚úÖ' : '‚ùå';
                    results += `<div>${status} ${test.name}: ${response.status}</div>`;
                } catch (error) {
                    results += `<div>‚ùå ${test.name}: Error ${error.message}</div>`;
                }
            }
            
            resultDiv.innerHTML = results;
        }
    </script>
</body>
</html>
