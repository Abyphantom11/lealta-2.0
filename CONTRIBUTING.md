# ü§ù Gu√≠a de Contribuci√≥n - Lealta 2.0

## üéØ **Bienvenido/a al Proyecto**

¬°Gracias por tu inter√©s en contribuir a Lealta 2.0! Esta gu√≠a te ayudar√° a entender c√≥mo participar efectivamente en el desarrollo del proyecto.

---

## üìã **Tabla de Contenidos**

1. [C√≥digo de Conducta](#c√≥digo-de-conducta)
2. [C√≥mo Contribuir](#c√≥mo-contribuir)
3. [Configuraci√≥n del Entorno](#configuraci√≥n-del-entorno)
4. [Flujo de Trabajo](#flujo-de-trabajo)
5. [Est√°ndares de C√≥digo](#est√°ndares-de-c√≥digo)
6. [Testing](#testing)
7. [Documentaci√≥n](#documentaci√≥n)
8. [Proceso de Review](#proceso-de-review)

---

## üìú **C√≥digo de Conducta**

### **Nuestros Valores**
- **Respeto:** Trata a todos con dignidad y profesionalismo
- **Colaboraci√≥n:** Trabaja en equipo para lograr objetivos comunes
- **Transparencia:** Comunica abierta y honestamente
- **Calidad:** Mant√©n altos est√°ndares en todo el trabajo
- **Aprendizaje:** Acepta feedback y busca mejora continua

### **Comportamientos Esperados**
- ‚úÖ Usar lenguaje inclusivo y profesional
- ‚úÖ Respetar diferentes perspectivas y experiencias
- ‚úÖ Dar y recibir feedback constructivo
- ‚úÖ Enfocarse en lo que es mejor para el proyecto
- ‚úÖ Mostrar empat√≠a hacia otros miembros del equipo

### **Comportamientos No Aceptados**
- ‚ùå Lenguaje ofensivo o comentarios despectivos
- ‚ùå Ataques personales o pol√≠ticos
- ‚ùå Acoso p√∫blico o privado
- ‚ùå Compartir informaci√≥n privada sin permiso
- ‚ùå Cualquier comportamiento inapropiado en contexto profesional

---

## üöÄ **C√≥mo Contribuir**

### **Tipos de Contribuciones**

#### üêõ **Reporte de Bugs**
- Usa el template de issue para bugs
- Incluye pasos para reproducir
- Especifica entorno (OS, browser, versi√≥n)
- Adjunta screenshots si es visual

#### ‚ú® **Nuevas Caracter√≠sticas**
- Discute la idea primero en un issue
- Aseg√∫rate de que alinee con la visi√≥n del producto
- Considera el impacto en performance y UX
- Incluye tests y documentaci√≥n

#### üìù **Mejoras de Documentaci√≥n**
- Correcciones de typos
- Clarificaci√≥n de instrucciones
- Adici√≥n de ejemplos
- Traducci√≥n a otros idiomas

#### üîß **Refactoring y Optimizaciones**
- Mejoras de performance
- Limpieza de c√≥digo legacy
- Actualizaci√≥n de dependencias
- Optimizaciones de build

---

## ‚öôÔ∏è **Configuraci√≥n del Entorno**

### **Prerequisitos**
```bash
# Versiones requeridas
node --version    # >= 18.0.0
npm --version     # >= 9.0.0
git --version     # >= 2.30.0
```

### **Setup Inicial**
```bash
# 1. Clonar el repositorio
git clone https://github.com/Abyphantom11/lealta-2.0.git
cd lealta-2.0

# 2. Instalar dependencias
npm install

# 3. Configurar variables de entorno
cp .env.example .env.local
# Editar .env.local con tus valores

# 4. Setup de base de datos
npx prisma generate
npx prisma db push

# 5. Verificar que todo funciona
npm run dev
npm run test
npm run lint
```

### **Variables de Entorno para Desarrollo**
```env
# Base de datos local
DATABASE_URL="postgresql://localhost:5432/lealta_dev"

# Auth (puedes usar valores de desarrollo)
NEXTAUTH_URL="http://localhost:3001"
NEXTAUTH_SECRET="development-secret-key"

# APIs externas (opcionales para desarrollo)
GEMINI_API_KEY="tu-api-key-de-gemini"
```

---

## üîÑ **Flujo de Trabajo**

### **Branch Strategy**

```
main                 ‚Üê Producci√≥n (protegida)
  ‚îú‚îÄ‚îÄ staging        ‚Üê Pre-producci√≥n
  ‚îú‚îÄ‚îÄ develop        ‚Üê Desarrollo principal
  ‚îî‚îÄ‚îÄ feature/*      ‚Üê Nuevas caracter√≠sticas
      ‚îú‚îÄ‚îÄ bugfix/*   ‚Üê Correcci√≥n de bugs
      ‚îî‚îÄ‚îÄ hotfix/*   ‚Üê Fixes urgentes para producci√≥n
```

### **Proceso de Desarrollo**

#### **1. Crear Feature Branch**
```bash
# Desde develop
git checkout develop
git pull origin develop

# Crear nueva branch
git checkout -b feature/nombre-descriptivo
# Ejemplos:
# feature/api-reservas-qr
# feature/dashboard-metricas
# bugfix/login-error-handling
```

#### **2. Desarrollo**
```bash
# Hacer commits frecuentes y descriptivos
git add .
git commit -m "feat: agregar endpoint para generar QR de reserva"

# Push regular para backup
git push origin feature/nombre-descriptivo
```

#### **3. Testing**
```bash
# Antes de crear PR, verificar que todo pase
npm run ci:quality-gates

# Esto ejecuta:
# - npm run lint
# - npm run typecheck  
# - npm run test
```

#### **4. Pull Request**
- Crear PR hacia `develop`
- Usar template de PR
- Asignar reviewers apropiados
- Incluir capturas de pantalla si aplica
- Referenciar issues relacionados

#### **5. Code Review**
- Responder a comentarios constructivamente
- Hacer cambios solicitados
- Re-request review despu√©s de cambios
- No hacer merge sin aprobaci√≥n

#### **6. Merge**
```bash
# Squash and merge (preferido)
# O merge commit si hay m√∫ltiples contributors
```

---

## üìù **Est√°ndares de C√≥digo**

### **Convenciones de Naming**

#### **Archivos y Directorios**
```
components/staff/StaffDashboard.tsx     # PascalCase para componentes
lib/auth/session-utils.ts               # kebab-case para utilities
app/api/reservas/route.ts              # kebab-case para rutas
types/api-responses.ts                 # kebab-case para types
```

#### **Variables y Funciones**
```typescript
// camelCase para variables y funciones
const userName = 'juan';
const fetchUserData = async () => {};

// PascalCase para componentes y clases
const StaffDashboard = () => {};
class ReservationService {}

// UPPER_SNAKE_CASE para constantes
const MAX_RETRY_ATTEMPTS = 3;
const API_BASE_URL = 'https://api.lealta.com';
```

### **Estructura de Componentes**
```typescript
// 1. Imports (externos primero, luego internos)
import React, { useState, useEffect } from 'react';
import { NextResponse } from 'next/server';
import { Button } from '@/components/ui/button';
import { useAuth } from '@/hooks/useAuth';

// 2. Types/Interfaces
interface StaffDashboardProps {
  businessId: string;
  initialData?: StaffData;
}

// 3. Componente principal
export default function StaffDashboard({ 
  businessId, 
  initialData 
}: StaffDashboardProps) {
  // 4. State y hooks
  const [loading, setLoading] = useState(false);
  const { user } = useAuth();

  // 5. Effects
  useEffect(() => {
    // logic here
  }, []);

  // 6. Event handlers
  const handleSubmit = async () => {
    // logic here
  };

  // 7. Render
  return (
    <div className="staff-dashboard">
      {/* JSX here */}
    </div>
  );
}
```

### **Est√°ndares de API**
```typescript
// Estructura consistente para API routes
export async function GET(request: NextRequest) {
  try {
    // 1. Autenticaci√≥n/autorizaci√≥n
    const auth = await requireAuth(request);
    
    // 2. Validaci√≥n de par√°metros
    const { searchParams } = new URL(request.url);
    const businessId = searchParams.get('businessId');
    
    if (!businessId) {
      return NextResponse.json(
        { error: 'businessId es requerido' },
        { status: 400 }
      );
    }

    // 3. L√≥gica de negocio
    const data = await fetchBusinessData(businessId);

    // 4. Respuesta exitosa
    return NextResponse.json({
      success: true,
      data
    });

  } catch (error) {
    // 5. Manejo de errores
    console.error('Error in GET /api/business:', error);
    return NextResponse.json(
      { error: 'Error interno del servidor' },
      { status: 500 }
    );
  }
}
```

### **Convenciones de Commit**

#### **Formato**
```
<tipo>(<alcance>): <descripci√≥n>

[cuerpo opcional]

[footer opcional]
```

#### **Tipos**
- `feat`: Nueva caracter√≠stica
- `fix`: Correcci√≥n de bug
- `docs`: Cambios en documentaci√≥n
- `style`: Formateo, punto y coma, etc.
- `refactor`: Refactoring de c√≥digo
- `test`: Agregar o modificar tests
- `chore`: Mantenimiento, deps, etc.

#### **Ejemplos**
```bash
feat(auth): agregar login con Google OAuth
fix(reservas): corregir validaci√≥n de fecha en QR
docs(api): actualizar documentaci√≥n de endpoints
refactor(components): extraer l√≥gica com√∫n a hook
test(staff): agregar tests para dashboard
chore(deps): actualizar Next.js a v14.2.32
```

---

## üß™ **Testing**

### **Tipos de Tests**

#### **Unit Tests**
```typescript
// tests/unit/auth/session.test.ts
import { describe, it, expect, vi } from 'vitest';
import { validateSession } from '@/lib/auth/session';

describe('validateSession', () => {
  it('should return true for valid session', () => {
    const mockSession = {
      user: { id: '1', email: 'test@test.com' },
      expires: '2025-12-31'
    };
    
    expect(validateSession(mockSession)).toBe(true);
  });

  it('should return false for expired session', () => {
    const mockSession = {
      user: { id: '1', email: 'test@test.com' },
      expires: '2020-01-01'
    };
    
    expect(validateSession(mockSession)).toBe(false);
  });
});
```

#### **Integration Tests**
```typescript
// tests/integration/api/reservas.test.ts
import { describe, it, expect } from 'vitest';
import { POST } from '@/app/api/reservas/route';

describe('/api/reservas', () => {
  it('should create new reservation', async () => {
    const request = new Request('http://localhost:3001/api/reservas', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        clienteId: '1',
        fecha: '2025-12-25',
        personas: 4
      })
    });

    const response = await POST(request);
    const data = await response.json();

    expect(response.status).toBe(201);
    expect(data.success).toBe(true);
    expect(data.data).toHaveProperty('id');
  });
});
```

#### **E2E Tests**
```typescript
// tests/e2e/staff-workflow.spec.ts
import { test, expect } from '@playwright/test';

test('staff can register new client', async ({ page }) => {
  await page.goto('/cmfnkcc1f0000eyj0dq0lcjji/staff');
  
  // Login
  await page.fill('[data-testid="email"]', 'staff@test.com');
  await page.fill('[data-testid="password"]', 'password123');
  await page.click('[data-testid="login-button"]');

  // Register new client
  await page.click('[data-testid="new-client-button"]');
  await page.fill('[data-testid="client-name"]', 'Juan P√©rez');
  await page.fill('[data-testid="client-cedula"]', '12345678');
  await page.click('[data-testid="save-client"]');

  // Verify success
  await expect(page.locator('[data-testid="success-message"]')).toBeVisible();
});
```

### **Ejecutar Tests**
```bash
# Unit tests
npm run test

# Integration tests
npm run test:staff

# E2E tests
npm run test:e2e

# Coverage
npm run test:coverage

# Watch mode
npm run test:watch
```

### **Testing Guidelines**
- ‚úÖ Escribe tests para nueva funcionalidad
- ‚úÖ Mant√©n coverage > 70%
- ‚úÖ Usa mocks para APIs externas
- ‚úÖ Tests descriptivos y legibles
- ‚úÖ Incluye casos edge y errores

---

## üìö **Documentaci√≥n**

### **Documentar Componentes**
```typescript
/**
 * Dashboard principal para el personal del restaurante
 * 
 * @param businessId - ID √∫nico del negocio
 * @param initialData - Datos iniciales (opcional, para SSR)
 * 
 * @example
 * ```tsx
 * <StaffDashboard 
 *   businessId="cmf123" 
 *   initialData={staffData} 
 * />
 * ```
 */
export default function StaffDashboard({
  businessId,
  initialData
}: StaffDashboardProps) {
  // ...
}
```

### **Documentar APIs**
```typescript
/**
 * GET /api/reservas
 * 
 * Obtiene lista de reservas para un negocio espec√≠fico
 * 
 * @param businessId - ID del negocio (query param)
 * @param fecha - Fecha espec√≠fica en formato YYYY-MM-DD (opcional)
 * @param status - Estado de reserva: PENDING|CONFIRMED|CANCELLED (opcional)
 * 
 * @returns {Object} Lista de reservas con metadata de paginaci√≥n
 * 
 * @example
 * GET /api/reservas?businessId=cmf123&fecha=2025-10-11&status=CONFIRMED
 */
export async function GET(request: NextRequest) {
  // ...
}
```

### **README de Features**
Cada feature importante debe tener documentaci√≥n:
```markdown
# Sistema de Reservas QR

## Descripci√≥n
Sistema que permite generar c√≥digos QR √∫nicos para cada reserva...

## Uso
1. Cliente hace reserva
2. Sistema genera QR √∫nico
3. Staff escanea QR para validar asistencia

## APIs Relacionadas
- `POST /api/reservas` - Crear reserva
- `GET /api/reservas/[id]/qr` - Generar QR
- `POST /api/reservas/scan-qr` - Validar QR

## Componentes
- `QRGenerator` - Genera c√≥digos QR
- `QRScanner` - Escanea c√≥digos QR
```

---

## üëÄ **Proceso de Review**

### **Como Reviewer**

#### **Qu√© Revisar**
- ‚úÖ **Funcionalidad:** ¬øCumple con los requirements?
- ‚úÖ **C√≥digo:** ¬øSigue est√°ndares y buenas pr√°cticas?
- ‚úÖ **Performance:** ¬øHay optimizaciones necesarias?
- ‚úÖ **Seguridad:** ¬øManeja auth y validaci√≥n correctamente?
- ‚úÖ **Tests:** ¬øIncluye tests apropiados?
- ‚úÖ **Documentaci√≥n:** ¬øEst√° bien documentado?

#### **C√≥mo Dar Feedback**
```markdown
# ‚úÖ Buen feedback
- "Considera usar useMemo aqu√≠ para optimizar re-renders"
- "Falta validaci√≥n de input en l√≠nea 45"
- "Podr√≠as extraer esta l√≥gica a un custom hook"

# ‚ùå Feedback no constructivo  
- "Esto est√° mal"
- "No me gusta este approach"
- "Cambia todo"
```

#### **Tipos de Comentarios**
- **‚ùó Cr√≠tico:** Debe ser corregido antes de merge
- **üí° Sugerencia:** Mejora recomendada
- **‚ùì Pregunta:** Necesita clarificaci√≥n
- **üëç Elogio:** Reconoce buen trabajo

### **Como Author**

#### **Antes de Crear PR**
```bash
# Self-review checklist
npm run ci:quality-gates  # ‚úÖ All checks pass
npm run test:e2e:critical # ‚úÖ Critical flows work
# ‚úÖ Manual testing completed
# ‚úÖ Documentation updated
# ‚úÖ Screenshots included (if UI changes)
```

#### **Responder a Reviews**
- üìù Responde a todos los comentarios
- üîÑ Haz cambios solicitados promptamente
- üí¨ Explica decisiones cuando sea necesario
- üôè Agradece el feedback constructivo
- üîÑ Re-request review despu√©s de cambios

---

## üö® **Situaciones Especiales**

### **Hotfixes**
```bash
# Para bugs cr√≠ticos en producci√≥n
git checkout main
git checkout -b hotfix/fix-critical-bug
# Fix the bug
git commit -m "hotfix: corregir error cr√≠tico en login"
# Create PR directly to main
# After merge, sync back to develop
```

### **Dependencies Updates**
```bash
# Actualizar deps regularmente
npm update
npm audit fix

# Para major updates, crear PR separado
npm install next@latest
# Test thoroughly
# Update code if needed
```

### **Breaking Changes**
- üì¢ Comunicar con antelaci√≥n
- üìù Documentar migration path
- üîÑ Incluir backwards compatibility cuando sea posible
- üìß Notificar a stakeholders

---

## üìû **Contacto y Soporte**

### **Equipo de Desarrollo**
- **Lead Developer:** @abyphantom11
- **Frontend Team:** #frontend-team
- **Backend Team:** #backend-team
- **DevOps:** #devops-team

### **Canales de Comunicaci√≥n**
- **Slack:** #lealta-development
- **Issues:** GitHub Issues para bugs y features
- **Discussions:** GitHub Discussions para preguntas generales
- **Email:** dev@lealta.com para asuntos urgentes

### **Reuniones Regulares**
- **Daily Standup:** 9:00 AM (Lun-Vie)
- **Sprint Planning:** Lunes 2:00 PM
- **Retrospective:** Viernes 4:00 PM
- **Code Review Sessions:** Martes/Jueves 3:00 PM

---

## üéâ **Reconocimientos**

¬°Agradecemos a todos los contributors que hacen posible Lealta 2.0!

### **Top Contributors**
- [@abyphantom11](https://github.com/Abyphantom11) - Project Lead & Core Developer

### **C√≥mo Ser Reconocido**
- üèÜ Contribuciones consistentes y de calidad
- ü§ù Ayudar a otros developers
- üìù Mejorar documentaci√≥n
- üêõ Reportar y fixear bugs
- üí° Proponer mejoras innovadoras

---

¬°Gracias por contribuir a Lealta 2.0! Tu trabajo ayuda a crear una mejor experiencia para restaurantes y sus clientes. üöÄ
